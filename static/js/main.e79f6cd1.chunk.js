(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{150:function(e,t,n){e.exports=n(334)},156:function(e,t,n){},251:function(e,t){},253:function(e,t){},286:function(e,t){},287:function(e,t){},334:function(e,t,n){"use strict";n.r(t);var a=n(2),r=n.n(a),c=n(48),o=n.n(c),i=n(10),l=n.n(i),s=n(49),u=n(21),p=n(65),h=n(35),d=n(36),m=n(38),f=n(37),g=n(60),v=n(39),b=(n(156),n(149)),w=n(61),y=n.n(w),E=n(62),x=n.n(E),O=n(145),j=n.n(O),D=n(63),k=n.n(D),C=n(147),S=n.n(C),W=n(86),_=n.n(W),R=n(40),T=n.n(R),B=function(e){function t(e){var n;return Object(h.a)(this,t),(n=Object(m.a)(this,Object(f.a)(t).call(this,e))).getDescription=Object(u.a)(l.a.mark(function e(){var t,a,r,c,o=arguments;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=o.length>0&&void 0!==o[0]?o[0]:n.props,a=t.fullDesc,r=t.faceMatcher,!a){e.next=10;break}return e.next=5,n.setState({descriptors:a.map(function(e){return e.descriptor}),detections:a.map(function(e){return e.detection})});case 5:if(!n.state.descriptors||!r){e.next=10;break}return e.next=8,n.state.descriptors.map(function(e){return r.findBestMatch(e)});case 8:c=e.sent,n.setState({match:c});case 10:case"end":return e.stop()}},e)})),n.state={descriptors:null,detections:null,match:null},n}return Object(v.a)(t,e),Object(d.a)(t,[{key:"componentDidMount",value:function(){this.getDescription()}},{key:"componentWillReceiveProps",value:function(e){this.getDescription(e)}},{key:"render",value:function(){var e=this.props,t=e.imageWidth,n=e.boxColor,a=this.state.detections,c=null;return a&&(c=a.map(function(e,a){var c=e.relativeBox,o=e._imageDims,i=t*c._x,l=c._y*t*o._height/o._width,s=t*c.width,u=c.height*t*o._height/o._width;return r.a.createElement("div",{key:a},r.a.createElement("div",{style:{position:"absolute",border:"solid",borderColor:n,height:u,width:s,top:0,left:0,transform:"translate(".concat(i,"px,").concat(l,"px)")}},r.a.createElement("div",{style:{color:"#fff",fontWeight:"bold",transform:"translate(0px,-18px)"}},"\u041b\u0418\u0426\u041e ",a+1)))})),r.a.createElement("div",null,c)}}]),t}(a.Component),F=n(148),I=n.n(F),H=function(e){function t(){var e,n;Object(h.a)(this,t);for(var a=arguments.length,c=new Array(a),o=0;o<a;o++)c[o]=arguments[o];return(n=Object(m.a)(this,(e=Object(f.a)(t)).call.apply(e,[this].concat(c)))).showButtons=function(){return r.a.createElement(j.a,{style:{float:"right"}},r.a.createElement(_.a,{size:"small",color:"primary",onClick:n.props.delete},"\u0423\u0434\u0430\u043b\u0438\u0442\u044c"))},n}return Object(v.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){var e=this.props,t=e.detections,n=e.width,a=null;t&&(a=t.map(function(e,t){var a=e.relativeBox,c=e._imageDims,o=n*a._x,i=a._y*n*c._height/c._width,l=n*a.width,s=a.height*n*c._height/c._width;return r.a.createElement("div",{key:t},r.a.createElement("div",{style:{position:"absolute",border:"solid",borderColor:"blue",height:s,width:l,top:0,left:0,transform:"translate(".concat(o,"px,").concat(i,"px)")}}))}));var c="myFileUpload"+this.props.title;return r.a.createElement("div",{style:{padding:"8px"}},r.a.createElement(y.a,{style:{width:this.props.width,height:"auto"}},r.a.createElement("input",{style:{display:"none"},id:c,type:"file",accept:"image/*",onChange:this.props.upload}),r.a.createElement(x.a,null,r.a.createElement("label",{htmlFor:c},r.a.createElement(S.a,{component:"img",src:this.props.photo?this.props.photo:"/static/images/upload3.png",style:{cursor:"pointer"}}),this.props.fullDesc?r.a.createElement(B,{fullDesc:this.props.fullDesc,imageWidth:this.props.width,boxColor:this.props.boxColor}):null,this.props.fullDesc?a:null,r.a.createElement(k.a,null,this.props.loading?r.a.createElement(I.a,null):r.a.createElement(T.a,{gutterBottom:!0,variant:"h5",component:"h2"},this.props.complete?this.props.detections<=0?r.a.createElement("span",null,"\u041b\u0438\u0446 \u043d\u0435 \u043e\u0431\u043d\u0430\u0440\u0443\u0436\u0435\u043d\u043e"):r.a.createElement("span",null,"\u041e\u0431\u043d\u0430\u0440\u0443\u0436\u0435\u043d\u043e \u043b\u0438\u0446 -"," ",this.props.detections.length):null),r.a.createElement(T.a,{component:"p"},this.props.loading?r.a.createElement("span",null,"\u041e\u043f\u0440\u0435\u0434\u0435\u043b\u044f\u044e \u043b\u0438\u0446\u0430..."):this.props.complete?null:r.a.createElement("span",null,"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u0435 \u0441\u0432\u043e\u044e \u0444\u043e\u0442\u043e\u0433\u0440\u0430\u0444\u0438\u044e, \u043d\u0430 \u043a\u043e\u0442\u043e\u0440\u043e\u0439 \u0445\u043e\u0440\u043e\u0448\u043e \u0432\u0438\u0434\u043d\u043e \u043b\u0438\u0446\u043e"))))),this.props.photo?this.showButtons():null))}}]),t}(a.Component),L=Object(b.withStyles)({card:{maxWidth:"600px"},media:{height:250}})(H),U=function(e){return r.a.createElement("div",null,r.a.createElement(y.a,{style:{maxWidth:"700px",marginTop:"15px"}},r.a.createElement(x.a,null,r.a.createElement(k.a,null,r.a.createElement(T.a,{gutterBottom:!0,variant:"h5",component:"h2",style:{color:e.result?"green":"red"}},function(e){var t=!1;if(e){var n=!0,a=!1,r=void 0;try{for(var c,o=e[Symbol.iterator]();!(n=(c=o.next()).done);n=!0)c.value.result<=.6&&(t=!0)}catch(i){a=!0,r=i}finally{try{n||null==o.return||o.return()}finally{if(a)throw r}}}return t}(e.result)?"\u0415\u0441\u0442\u044c \u0441\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u044f":"\u041d\u0435\u0442 \u0441\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0439"),(t=e.result)?t.map(function(e,t){return r.a.createElement(T.a,{component:"p",key:t},r.a.createElement("span",null,r.a.createElement("strong",null,"\u041b\u0438\u0446\u043e ",e.faceOne+1)," [left] \u0438"," ",r.a.createElement("strong",null,"\u041b\u0438\u0446\u043e ",e.faceTwo+1)," [right] -"," ",e.result<=.6?"\u043f\u043e\u0445\u043e\u0436\u0438":"\u043d\u0435 \u043f\u043e\u0445\u043e\u0436\u0438"," (",Math.abs(100*e.result-100),"%)"))}):null))));var t},M=n(20);function P(){return z.apply(this,arguments)}function z(){return(z=Object(u.a)(l.a.mark(function e(){var t;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t="/faces-recognition/models",e.next=3,M.i(t);case 3:return e.next=5,M.g(t);case 5:return e.next=7,M.h(t);case 7:case"end":return e.stop()}},e)}))).apply(this,arguments)}function A(e){return G.apply(this,arguments)}function G(){return(G=Object(u.a)(l.a.mark(function e(t){var n,a,r,c,o,i=arguments;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:512,.5,a=new M.c({inputSize:n,scoreThreshold:.5}),r=!0,e.next=6,M.f(t);case 6:return c=e.sent,e.next=9,M.d(c,a).withFaceLandmarks(r).withFaceDescriptors();case 9:return o=e.sent,e.abrupt("return",o);case 11:case"end":return e.stop()}},e)}))).apply(this,arguments)}var J={imageURL:"",WIDTH:null,HEIGHT:0,fullDesc:null,detections:null,descriptors:null,match:null,loading:!1,complete:!1},N=450,q="#BE80B5",K=function(e){function t(){var e,n;Object(h.a)(this,t);for(var a=arguments.length,c=new Array(a),o=0;o<a;o++)c[o]=arguments[o];return(n=Object(m.a)(this,(e=Object(f.a)(t)).call.apply(e,[this].concat(c)))).state={cards:[Object(p.a)({},J,{title:"Photo 1"}),Object(p.a)({},J,{title:"Photo 2"})]},n.componentWillMount=Object(u.a)(l.a.mark(function e(){var t,a;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(t=document.documentElement.clientWidth)>N&&(t=N),(a=Object(s.a)(n.state.cards)).map(function(e,n){return a[n].WIDTH=t}),n.setState({cards:a}),e.next=7,P();case 7:return e.next=9,n.setState({isModelLoaded:!!M.j.tinyFaceDetector.params});case 9:case"end":return e.stop()}},e)})),n.handleImage=function(){var e=Object(u.a)(l.a.mark(function e(t,a){var r;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(r=Object(s.a)(n.state.cards))[a].loading=!1,r[a].complete=!0,e.next=5,A(t).then(function(e){e&&(r[a].fullDesc=e,r[a].detections=e.map(function(e){return e.detection}),n.setState({cards:r}))});case 5:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}(),n.handleFileChange=function(){var e=Object(u.a)(l.a.mark(function e(t,a){var r,c,o;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=Object(g.a)(n);try{t.target.files&&(c=document.createElement("img"),o=URL.createObjectURL(t.target.files[0]),c.src=o,c.onload=Object(u.a)(l.a.mark(function e(){var t,n;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=Object(s.a)(r.state.cards),n=t[a].WIDTH*c.height/c.width,t[a].HEIGHT=n,t[a].imageDimension={width:c.width,height:c.height},t[a].imageURL=o||"",t[a].loading=!0,t[a].complete=!1,e.next=9,r.setState({cards:t});case 9:return e.next=11,r.handleImage(r.state.cards[a].imageURL,a);case 11:case"end":return e.stop()}},e)})))}catch(i){console.log(i)}case 2:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}(),n.handleDeleteFile=function(e){var t=Object(s.a)(n.state.cards),a=document.documentElement.clientWidth;a>N&&(a=N),t[e]=Object(p.a)({},J,{title:"Photo "+(e+1),loading:!1}),t[e].WIDTH=a,n.setState({cards:t})},n.showCards=function(){return n.state.cards.map(function(e,t){return r.a.createElement(L,Object.assign({key:t,title:e.title,photo:e.imageURL,width:e.WIDTH,upload:function(e){n.handleFileChange(e,t)},delete:function(){n.handleDeleteFile(t)},fullDesc:e.fullDesc,boxColor:q,detections:e.detections},e,{style:{display:"flex"}}))})},n.isShowResult=function(){var e=0;return n.state.cards.map(function(t,n){return t.complete&&t.detections.length>0&&e++,null}),e>=n.state.cards.length&&(n.getResultSimilary(),!0)},n.getResultSimilary=function(){return function(e,t){for(var n=[],a=e.fullDesc,r=t.fullDesc,c=0;c<a.length;c++)for(var o=a[c].descriptor,i=0;i<r.length;i++){var l=r[i].descriptor;n.push({faceOne:c,faceTwo:i,result:M.k(M.e(o,l))})}return n}(n.state.cards[0],n.state.cards[1])},n}return Object(v.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"container"},this.state.cards?this.showCards():null),this.isShowResult()?r.a.createElement("div",{className:"container"},r.a.createElement(U,{result:this.getResultSimilary()})):null)}}]),t}(a.Component);o.a.render(r.a.createElement(K,null),document.getElementById("root"))}},[[150,1,2]]]);
//# sourceMappingURL=main.e79f6cd1.chunk.js.map